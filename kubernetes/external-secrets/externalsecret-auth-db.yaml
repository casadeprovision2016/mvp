apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: auth-db-credentials
  namespace: production
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: SecretStore
  target:
    name: auth-db-credentials
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        password: "{{ .password }}"
        username: "cotai_auth"
        host: "10.20.30.10"  # Cloud SQL private IP
        port: "5432"
        database: "cotai_auth"
        connection-string: "postgresql://cotai_auth:{{ .password }}@10.20.30.10:5432/cotai_auth?sslmode=require"
  dataFrom:
    - extract:
        key: cotai-auth-db-password
